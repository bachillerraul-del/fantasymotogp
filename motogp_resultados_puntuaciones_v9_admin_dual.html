<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MotoGP Fantasy ‚Äî Resultados (Sprint/Carrera) & Puntuaciones por Equipo</title>
  <meta name="description" content="Resultados por GP con desglose Sprint/Carrera y detalle de puntuaci√≥n por equipo.">
  <style>
    :root{
      --bg:#0f1115; --panel:#171a21; --ink:#e9eef5; --muted:#9aa4b2; --line:#242b37;
      --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --chip:#0e1218; --accent:#58a6ff;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    a{color:var(--accent);text-decoration:none}
    header{position:sticky;top:0;background:#10141d; border-bottom:1px solid var(--line); z-index:10; backdrop-filter: blur(6px)}
    .wrap{max-width:1100px;margin:auto;padding:12px 14px}
    h1{margin:0;font-size:1.1rem}
    .bar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:6px}
    select,input,button,textarea{border:1px solid var(--line);border-radius:12px;background:#0f131b;color:var(--ink);padding:10px 12px}
    button{cursor:pointer}
    main{max-width:1100px;margin:12px auto;padding:0 14px 24px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:12px}
    .panel h2{margin:6px 6px 10px;font-size:1rem;color:#dbe5f1}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left;font-size:.95rem}
    thead th{position:sticky;top:0;background:#141924;z-index:1}
    .muted{color:var(--muted)}
    .right{text-align:right}
    .chip{display:inline-flex;gap:8px;align-items:center;background:var(--chip);border:1px solid var(--line);border-radius:999px;padding:6px 10px}
    .small{font-size:.88rem}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .tools{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .tot{font-weight:800}
    .ok{color:#b7ffd0}
    .warn{color:#ffe0a6}
    .bad{color:#ffc2c2}
    details summary{cursor:pointer; user-select:none}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;background:#0b0f16;border:1px solid #1b2332;border-radius:6px;padding:2px 6px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}

    /* Mobile-first improvements */
    @media (max-width:720px){
      .table-wrap{display:none}
      .cards{display:flex;flex-direction:column;gap:10px}
      .card{border:1px solid var(--line);background:#0f131b;border-radius:12px;padding:10px}
      .card .head{display:flex;justify-content:space-between;align-items:center;gap:8px}
      .card .team{font-weight:800}
      .badge{border:1px solid var(--line);padding:4px 8px;border-radius:999px}
      .breakdown{margin-top:8px;border-top:1px dashed var(--line);padding-top:8px}
      .pilot-row{display:flex;justify-content:space-between;gap:8px;padding:6px 0;border-bottom:1px dashed #1a2231}
      .pilot-row:last-child{border-bottom:0}
      .pilot-name{font-weight:600}
      .pts{white-space:nowrap}
    }
    @media (min-width:721px){
      .table-wrap{display:block}
      .cards{display:none}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>üèÅ MotoGP Fantasy ‚Äî Resultados por GP (Sprint/Carrera) y Puntuaci√≥n de Equipos</h1>
      <div class="bar">
        <div class="chip">GP: 
          <select id="gpSelect"></select>
        </div>
        <div class="chip">Ordenar: 
          <select id="sortBy">
            <option value="totalDesc">Total ‚Üì</option>
            <option value="totalAsc">Total ‚Üë</option>
            <option value="nameAsc">Equipo A‚ÜíZ</option>
          </select>
        </div>
        <div class="chip">Vista: 
          <select id="viewMode">
            <option value="gp">Este GP</option>
            <option value="season">Acumulado temporada</option>
          </select>
        </div>
        <div class="chip small">Equipos: <b id="teamsCount">0</b></div>
      </div>
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="panel">
        <h2>Clasificaci√≥n <span id="titleSuffix" class="muted"></span></h2>
        <div class="row">
  <input id="urlInput" placeholder="https://... (URL JSON)" style="flex:2" />
  <button id="loadUrlBtn" class="small" disabled title="Solo admin">Cargar URL (Admin)</button>
  <button id="loadFileBtn" class="small" disabled title="Solo admin">Cargar archivo (Admin)</button>
          <div class="chip small" title="URL por defecto para Admin">
            URL por defecto: <span id="defUrl" class="mono" style="max-width:420px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"></span>
          </div>
          <button id="copyDefUrlBtn" class="small">Copiar URL</button>
          <input id="filter" placeholder="Filtrar equipos..." style="flex:1" />
          <button id="exportBtn">Exportar JSON</button>
<button id="adminLoadBtn" class="warn" onclick="try{adminLoad()}catch(e){console&&console.error(e)}">Cargar datos (Admin)</button>
<button id="adminLoadBtn" class="warn">Cargar datos (Admin)</button>
          <button id="resetBtn" class="muted">Reset demo</button>
        </div>

        <!-- Desktop table -->
        <div class="table-wrap" style="overflow:auto;max-height:70vh;margin-top:10px">
          <table id="tbl">
            <thead>
              <tr>
                <th style="width:48px">#</th>
                <th>Equipo</th>
                <th class="right">Total</th>
                <th>Detalle (Sprint / Carrera / Total)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Mobile cards -->
        <div id="cards" class="cards"></div>
      </section>

      <aside class="panel">
        <h2>Datos (equipos y resultados)</h2>
        <details>
          <summary><b>C√≥mo funciona</b></summary>
          <div class="small muted" style="margin-top:8px">
            <p>1) Edita los datos en JSON y pulsa <span class="kbd">Guardar</span>. Se guarda en <b>localStorage</b>.</p>
            <p>2) El formato de resultados por piloto puede ser <code class="kbd">n√∫mero</code> (total) o <code class="kbd">{{ "sprint": n, "race": m }}</code>.</p>
            <p>3) Selecciona un GP para ver el desglose Sprint/Carrera; o ‚ÄúAcumulado‚Äù para sumar todos.</p>
          </div>
        </details>
        <div class="tools">
          <button id="saveBtn" disabled title="Solo admin">Guardar</button>
          <button id="loadDemoBtn">Cargar demo</button>
          <input type="file" id="fileInput" accept=".json,application/json" disabled title="Solo admin" />
        </div>
        <textarea id="jsonBox" rows="20" style="width:100%;margin-top:8px" spellcheck="false" class="mono"></textarea>
      </aside>
    </div>
  </main>

  <script>
    // ======= Estructura de datos =======
    // data = {
    //   gps: ["Qatar 2025", ...],
    //   results: {
    //     "Qatar 2025": {
    //        "Piloto": { "sprint": 8, "race": 18 }  // o solo n√∫mero => total (sprint=0, race=total)
    //     }, ...
    //   },
    //   teams: [ { name: "Mi Equipo", members: ["Piloto1",...,"Piloto5"] } ]
    // }

    const LOCAL_KEY = 'motogp_results_v2';
    const DEFAULT_URL = 'https://raw.githubusercontent.com/bachillerraul-del/fantasymotogp/main/motogp_resultados_austria2025_FIM.json'; // <-- c√°mbiala por tu URL real

    function demoData(){
      return {
        gps: ["Qatar 2025","Portugal 2025","Austria 2025"],
        results: {
          "Qatar 2025": {
            "Marc M√°rquez": {"sprint":12,"race":25}, "Francesco Bagnaia": {"sprint":7,"race":23}, "Pedro Acosta": {"sprint":8,"race":20},
            "Jorge Mart√≠n": {"sprint":10,"race":10}, "Marco Bezzecchi": {"sprint":5,"race":13},
            "Ferm√≠n Aldeguer": {"sprint":6,"race":10}, "Brad Binder": {"sprint":8,"race":6}, "Fabio Di Giannantonio": {"sprint":5,"race":8},
            "Ra√∫l Fern√°ndez": {"sprint":6,"race":6}, "Franco Morbidelli": {"sprint":5,"race":6},
            "Fabio Quartararo": {"sprint":4,"race":6}, "Enea Bastianini": {"sprint":3,"race":6},
            "Luca Marini": {"sprint":2,"race":4}, "Maverick Vi√±ales": {"sprint":2,"race":3}, "√Ålex M√°rquez": {"sprint":4,"race":4},
            "Johann Zarco": {"sprint":2,"race":2}, "√Ålex Rins": {"sprint":1,"race":2}, "Somkiat Chantra": {"sprint":1,"race":1},
            "Joan Mir": {"sprint":0,"race":1}, "Jack Miller": 0, "Miguel Oliveira": 0
          },
          "Portugal 2025": {
            "Marc M√°rquez": {"sprint":10,"race":15}, "Francesco Bagnaia": {"sprint":12,"race":22}, "Pedro Acosta": {"sprint":7,"race":15},
            "Jorge Mart√≠n": {"sprint":9,"race":19}, "Marco Bezzecchi": {"sprint":6,"race":14},
            "Ferm√≠n Aldeguer": {"sprint":5,"race":9}, "Brad Binder": {"sprint":6,"race":5}, "Fabio Di Giannantonio": {"sprint":4,"race":6},
            "Ra√∫l Fern√°ndez": {"sprint":4,"race":5}, "Franco Morbidelli": {"sprint":3,"race":4},
            "Fabio Quartararo": {"sprint":5,"race":8}, "Enea Bastianini": {"sprint":3,"race":5},
            "Luca Marini": {"sprint":2,"race":4}, "Maverick Vi√±ales": {"sprint":2,"race":3}, "√Ålex M√°rquez": {"sprint":1,"race":3},
            "Johann Zarco": {"sprint":1,"race":2}, "√Ålex Rins": {"sprint":1,"race":1}, "Somkiat Chantra": {"sprint":0,"race":1},
            "Joan Mir": 0, "Jack Miller": 0, "Miguel Oliveira": 0
          },
          "Austria 2025": {
            "Marc M√°rquez": {"sprint":12,"race":28}, "Francesco Bagnaia": {"sprint":7,"race":9}, "Pedro Acosta": {"sprint":12,"race":20},
            "Jorge Mart√≠n": {"sprint":10,"race":15}, "Marco Bezzecchi": {"sprint":8,"race":14},
            "Ferm√≠n Aldeguer": {"sprint":6,"race":12}, "Brad Binder": {"sprint":6,"race":6}, "Fabio Di Giannantonio": {"sprint":4,"race":6},
            "Ra√∫l Fern√°ndez": {"sprint":3,"race":5}, "Franco Morbidelli": {"sprint":2,"race":4},
            "Fabio Quartararo": {"sprint":1,"race":4}, "Enea Bastianini": {"sprint":1,"race":3},
            "Luca Marini": {"sprint":1,"race":2}, "Maverick Vi√±ales": {"sprint":1,"race":1}, "√Ålex M√°rquez": {"sprint":0,"race":1},
            "Johann Zarco": 0, "√Ålex Rins": 0, "Somkiat Chantra": 0, "Joan Mir": 0, "Jack Miller": 0, "Miguel Oliveira": 0
          }
        },
        teams: [
          { name: "BoxGresini", members: ["Marc M√°rquez","√Ålex M√°rquez","Ferm√≠n Aldeguer","Fabio Di Giannantonio","Brad Binder"] },
          { name: "ApriliaPower", members: ["Marco Bezzecchi","Jorge Mart√≠n","Ra√∫l Fern√°ndez","Fabio Quartararo","Luca Marini"] },
          { name: "KTM Boys", members: ["Pedro Acosta","Brad Binder","Enea Bastianini","Maverick Vi√±ales","Jack Miller"] },
          { name: "Ducatistas", members: ["Francesco Bagnaia","Marc M√°rquez","Ferm√≠n Aldeguer","√Ålex Rins","Joan Mir"] }
        ]
      };
    }

    function loadData(){
      try{
        const raw = localStorage.getItem(LOCAL_KEY);
        if(raw) return JSON.parse(raw);
      }catch{}
      return demoData();
    }
    function saveData(d){
      try{ localStorage.setItem(LOCAL_KEY, JSON.stringify(d)); }catch{}
    }

    let data = loadData();

    // ======= Helpers =======
    function normPoints(val){
      if(typeof val === 'number'){ return { sprint:0, race:Number(val) }; }
      if(val && typeof val === 'object'){
        const s = Number(val.sprint||0), r = Number(val.race||0);
        return { sprint:s, race:r };
      }
      return { sprint:0, race:0 };
    }
    function sumParts(parts){ return parts.reduce((a,b)=> a + b.pts.sprint + b.pts.race, 0); }

    // ======= UI refs =======
    const gpSelect = document.getElementById('gpSelect');
    const sortBy = document.getElementById('sortBy');
    const viewMode = document.getElementById('viewMode');
    const filter = document.getElementById('filter');
    const tblBody = document.querySelector('#tbl tbody');
    const cards = document.getElementById('cards');
    const titleSuffix = document.getElementById('titleSuffix');
    const teamsCount = document.getElementById('teamsCount');
    const jsonBox = document.getElementById('jsonBox');

    function fillSelectors(){
      gpSelect.innerHTML='';
      data.gps.forEach(gp=>{
        const opt=document.createElement('option'); opt.value=gp; opt.textContent=gp; gpSelect.appendChild(opt);
      });
      teamsCount.textContent = data.teams.length;
    }

    function teamPartsForGP(team, gp){
      const res = data.results[gp] || {};
      return team.members.map(p => ({
        pilot:p,
        pts: normPoints(res[p])
      }));
    }

    function teamPartsSeason(team){
      // suma sprint/carrera por piloto en todos los gps
      const sum = {}; // pilot -> {sprint, race}
      data.gps.forEach(gp=>{
        const res = data.results[gp] || {};
        team.members.forEach(p => {
          const cur = normPoints(res[p]);
          const acc = sum[p] || { sprint:0, race:0 };
          sum[p] = { sprint: acc.sprint + cur.sprint, race: acc.race + cur.race };
        });
      });
      return team.members.map(p => ({ pilot:p, pts: sum[p] || { sprint:0, race:0 } }));
    }

    function computeRows(){
      const mode = viewMode.value;
      const gp = gpSelect.value;
      const rows = data.teams.map(t => {
        const parts = (mode==='gp')? teamPartsForGP(t,gp) : teamPartsSeason(t);
        const total = sumParts(parts);
        return { team:t.name, parts, total };
      });
      const q = filter.value.trim().toLowerCase();
      let L = rows.filter(r => r.team.toLowerCase().includes(q));
      // sorting
      if(sortBy.value==='totalDesc') L.sort((a,b)=> b.total - a.total);
      if(sortBy.value==='totalAsc') L.sort((a,b)=> a.total - b.total);
      if(sortBy.value==='nameAsc') L.sort((a,b)=> a.team.localeCompare(b.team,'es'));
      return L;
    }

    function renderTable(){
      titleSuffix.textContent = (viewMode.value==='gp')? `¬∑ ${gpSelect.value}` : '¬∑ Acumulado temporada';
      const rows = computeRows();

      // Desktop table
      if(tblBody){
        tblBody.innerHTML='';
        rows.forEach((r,idx)=>{
          const tr=document.createElement('tr');
          const pos = document.createElement('td'); pos.textContent = String(idx+1); tr.appendChild(pos);
          const name = document.createElement('td'); name.innerHTML = `<b>${r.team}</b>`; tr.appendChild(name);
          const tot = document.createElement('td'); tot.className='right tot'; tot.textContent = r.total.toString(); tr.appendChild(tot);
          const det = document.createElement('td');

          const details = document.createElement('details');
          const summary = document.createElement('summary'); summary.textContent='Ver detalle'; details.appendChild(summary);
          const inner = document.createElement('div'); inner.className='small'; inner.style.marginTop='6px';

          // Sort pilots by total points (Sprint+Carrera) desc
          r.parts.sort((p1,p2)=> (p2.pts.sprint + p2.pts.race) - (p1.pts.sprint + p1.pts.race));

          // Build a mini-table inside for Sprint/Carrera/Total
          let html = '<table style="width:100%;border-collapse:collapse">';
          html += '<thead><tr><th>Piloto</th><th class="right">Sprint</th><th class="right">Carrera</th><th class="right">Total</th></tr></thead><tbody>';
          r.parts.forEach(p => {
            const s = p.pts.sprint, c = p.pts.race, t = s+c;
            html += `<tr><td>${p.pilot}</td><td class="right">${s}</td><td class="right">${c}</td><td class="right"><b>${t}</b></td></tr>`;
          });
          html += '</tbody></table>';
          inner.innerHTML = html;

          details.appendChild(inner);
          det.appendChild(details); tr.appendChild(det);
          tblBody.appendChild(tr);
        });
      }

      // Mobile cards
      cards.innerHTML='';
      rows.forEach((r,idx)=>{
        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `<div class="head">
            <div class="team">${idx+1}. ${r.team}</div>
            <div class="badge">Total <b>${r.total}</b></div>
          </div>`;
        const bd = document.createElement('div'); bd.className='breakdown';
        // Pilot rows (sorted)
        r.parts.slice().sort((p1,p2)=> (p2.pts.sprint + p2.pts.race) - (p1.pts.sprint + p1.pts.race)).forEach(p => {
          const s = p.pts.sprint, c = p.pts.race, t = s+c;
          const row = document.createElement('div'); row.className='pilot-row';
          row.innerHTML = `<div class="pilot-name">${p.pilot}</div>
                           <div class="pts">S:${s} ¬∑ C:${c} ¬∑ <b>${t}</b></div>`;
          bd.appendChild(row);
        });
        card.appendChild(bd);
        cards.appendChild(card);
      });
    }

    // ======= JSON editor / import / export =======
    function exportJSON(){
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'motogp_resultados.json';
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function loadJSONToEditor(){ document.getElementById('jsonBox').value = JSON.stringify(data, null, 2); }
    function saveFromEditor(){
      try{
        const parsed = JSON.parse(document.getElementById('jsonBox').value);
        if(!parsed.gps || !parsed.results || !parsed.teams) throw new Error('Estructura inv√°lida');
        data = parsed; saveData(data); fillSelectors(); renderTable(); alert('Datos guardados ‚úÖ');
      }catch(e){ alert('JSON inv√°lido ‚ùå: ' + e.message); }
    }
    function resetDemo(){ data = demoData(); saveData(data); fillSelectors(); loadJSONToEditor(); renderTable(); }
    
function handleFileImport(ev){
  const file = ev.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try{
      const parsed = JSON.parse(reader.result);
      if(!parsed.gps || !parsed.results || !parsed.teams) throw new Error('Estructura inv√°lida (faltan gps/results/teams)');
      data = parsed;
      saveData(data);
      fillSelectors();
      renderTable();
      loadJSONToEditor(); // refleja en el editor
      alert('Datos importados y aplicados ‚úÖ');
    }catch(e){
      alert('JSON inv√°lido ‚ùå: ' + e.message);
      // como fallback, colocamos el texto en el editor para que el admin lo revise
      try{ document.getElementById('jsonBox').value = reader.result; }catch{}
    }
  };
  reader.readAsText(file, 'utf-8');
}


    
    // ======= Admin PIN unlock =======
    let adminUnlocked = false;
    const ADMIN_PIN = '1395';

    function setAdminUI(enabled){
      adminUnlocked = !!enabled;
      const dis = !enabled;
      const ids = ['saveBtn','fileInput','loadUrlBtn','loadFileBtn'];
      ids.forEach(id=>{ const el=document.getElementById(id); if(!el) return; el.disabled = dis; el.title = enabled? '' : 'Solo admin';});
    }

    async 


function adminLoad(){
  try{ console.log('[Admin] click'); }catch(_){}
  if(!adminUnlocked){
    const pin = prompt('Introduce PIN de administrador:');
    if(pin !== ADMIN_PIN){ alert('PIN incorrecto'); return; }
    setAdminUI(true);
  }
  const url = prompt("Introduce la URL del JSON (o deja vac√≠o para cargar un archivo local):", DEFAULT_URL);
  if(url === null){ console.log('[Admin] cancelado'); return; } // cancel
  if(url){
    (async () => {
      try{
        console.log('[Admin] fetching URL:', url);
        const resp = await fetch(url, { cache: 'no-store' });
        if(!resp.ok) throw new Error("HTTP "+resp.status);
        const parsed = await resp.json();
        if(!parsed.gps || !parsed.results || !parsed.teams) throw new Error("Formato inv√°lido (faltan gps/results/teams)");
        data = parsed;
        saveData(data);
        fillSelectors();
        renderTable();
        loadJSONToEditor();
        alert("Datos cargados desde URL ‚úÖ");
      }catch(e){
        console.error(e);
        alert("Error cargando URL ‚ùå: " + e.message);
      }
    })();
  } else {
    console.log('[Admin] fallback file input');
    const fi = document.getElementById('fileInput');
    if(fi){ fi.click(); } else { alert('No se encontr√≥ el selector de archivo'); }
  }
}

    setAdminUI(true);
  }

  const url = prompt("Introduce la URL del JSON (o deja vac√≠o para cargar un archivo local):", DEFAULT_URL);
  if(url === null){ return; } // cancelado
  if(url){
    (async () => {
      try{
        const resp = await fetch(url, { cache: 'no-store' });
        if(!resp.ok) throw new Error("HTTP "+resp.status);
        const parsed = await resp.json();
        if(!parsed.gps || !parsed.results || !parsed.teams) throw new Error("Formato inv√°lido (faltan gps/results/teams)");
        data = parsed;
        saveData(data);
        fillSelectors();
        renderTable();
        loadJSONToEditor();
        alert("Datos cargados desde URL ‚úÖ");
      }catch(e){
        alert("Error cargando URL ‚ùå: " + e.message);
      }
    })();
  } else {
    document.getElementById('fileInput').click();
  }
}

    setAdminUI(true);
  }

  const url = prompt("Introduce la URL del JSON (o deja vac√≠o para cargar un archivo local):");
  if(url){
    (async () => {
      try{
        const resp = await fetch(url, { cache: 'no-store' });
        if(!resp.ok) throw new Error("HTTP "+resp.status);
        const parsed = await resp.json();
        if(!parsed.gps || !parsed.results || !parsed.teams) throw new Error("Formato inv√°lido (faltan gps/results/teams)");
        data = parsed;
        saveData(data);
        fillSelectors();
        renderTable();
        loadJSONToEditor();
        alert("Datos cargados desde URL ‚úÖ");
      }catch(e){
        alert("Error cargando URL ‚ùå: " + e.message);
      }
    })();
  } else {
    document.getElementById('fileInput').click();
  }
}

        setAdminUI(true);
      }
      // Abre el selector de archivo para cargar JSON
      document.getElementById('fileInput').click();
    }

    
    function ensureAdmin(){
      if(adminUnlocked) return true;
      const pin = prompt('Introduce PIN de administrador:');
      if(pin !== ADMIN_PIN){ alert('PIN incorrecto'); return false; }
      setAdminUI(true);
      return true;
    }

    // Listeners
    gpSelect.addEventListener('change', renderTable);
    sortBy.addEventListener('change', renderTable);
    viewMode.addEventListener('change', renderTable);
    filter.addEventListener('input', renderTable);
    document.getElementById('exportBtn').addEventListener('click', exportJSON);

    const urlInput = document.getElementById('urlInput');
    if(urlInput) urlInput.value = (typeof DEFAULT_URL !== 'undefined' ? DEFAULT_URL : '');

    const loadUrlBtn = document.getElementById('loadUrlBtn');
    if(loadUrlBtn) loadUrlBtn.addEventListener('click', async ()=>{
      if(!ensureAdmin()) return;
      const url = (document.getElementById('urlInput')?.value || '').trim();
      if(!url) { alert('Introduce una URL v√°lida'); return; }
      try{
        const resp = await fetch(url, { cache: 'no-store' });
        if(!resp.ok) throw new Error('HTTP '+resp.status);
        const parsed = await resp.json();
        if(!parsed.gps || !parsed.results || !parsed.teams) throw new Error('Formato inv√°lido (faltan gps/results/teams)');
        data = parsed; saveData(data); fillSelectors(); renderTable(); loadJSONToEditor();
        alert('Datos cargados desde URL ‚úÖ');
      }catch(e){
        alert('Error cargando URL ‚ùå: ' + e.message);
        console.error(e);
      }
    });

    const loadFileBtn = document.getElementById('loadFileBtn');
    if(loadFileBtn) loadFileBtn.addEventListener('click', ()=>{
      if(!ensureAdmin()) return;
      const fi = document.getElementById('fileInput'); if(fi) fi.click();
    });

    document.getElementById('adminLoadBtn').addEventListener('click', adminLoad);
    document.getElementById('saveBtn').addEventListener('click', saveFromEditor);
    document.getElementById('loadDemoBtn').addEventListener('click', resetDemo);
    document.getElementById('resetBtn').addEventListener('click', resetDemo);
    document.getElementById('fileInput').addEventListener('change', handleFileImport);

        // Init
    setAdminUI(false);
    try{
      if(document.getElementById('defUrl')) document.getElementById('defUrl').textContent = DEFAULT_URL;
      if(document.getElementById('copyDefUrlBtn')) document.getElementById('copyDefUrlBtn').addEventListener('click', ()=> navigator.clipboard.writeText(DEFAULT_URL));
      if(document.getElementById('urlInput')) document.getElementById('urlInput').value = DEFAULT_URL;
    }catch(_){/*no-op*/}
    const defUrlSpan = document.getElementById('defUrl'); if(defUrlSpan) defUrlSpan.textContent = DEFAULT_URL;
    const copyBtn = document.getElementById('copyDefUrlBtn'); if(copyBtn) copyBtn.addEventListener('click', ()=> navigator.clipboard.writeText(DEFAULT_URL));
    fillSelectors();
    loadJSONToEditor();
    renderTable();
  </script>
</body>
</html>
